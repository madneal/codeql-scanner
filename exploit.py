import sys
import requests
from optparse import OptionParser  


def check_version(target, proxy):
    urls = [
        target + "CHANGELOG.txt",
        target + "core/CHANGELOG.txt",
        target + "includes/bootstrap.inc",
        target + "core/includes/bootstrap.inc",
    ]
    for url in urls:
        res = http_post(url, proxy=proxy)
        if res.status_code == 200:
            print('For url {}, the response code is 200'.format(url))
            if 'SA-CORE-2018-002' in res.text:
                print('Url:{} may be vulerable to SA-CORE-2018-002'.format(url))


def welcome():
    print('################################################')
    print('Exploit code for Drupalgeddon2: CVE-2018-7600')
    print('Authot: Neal')
    print('The script is only used for educational purpose')
    print('################################################')

def init_options():
    parser = OptionParser()  
    parser.add_option("-t", "--target", dest="target", help="set the target, http://ip:port")  
    parser.add_option("-p", "--proxy",  dest="proxy", help="set the proxy, http://ip:port")  
    (options, args) = parser.parse_args()  
    if 'target' not in options:
        parser.error('Target is not set')
    return options

def http_post(url, payload="", proxy=None):
    res = requests.post(url, proxy=proxy, data=payload)
    return res

if __name__ == "__main__":
    welcome()
    # target = get_target()
    ua = "drupalgeddon2"
    options = init_options()
    target = options['target']
    proxy = options['proxy']